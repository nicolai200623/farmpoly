# Polymarket Trading Bot Configuration
# =====================================
# Updated with V2 features: Playwright, Gamma API, USDC Approval

# Capital Settings
total_capital: 30  # Total capital in USDC (start small!)
num_wallets: 1  # Number of wallets to use (2-10 recommended)

# RPC Settings
rpc_url: "https://polygon-mainnet.g.alchemy.com/v2/FQJnJWsEQLZqOJuRTH6n_FZEkyWx2vO1"  # Use your own Alchemy/Infura for better reliability

# Market Scanner Settings (V2 - Playwright + Gamma API)
market_scanner:
  interval: 60  # Scan interval in seconds
  min_reward: 10  # Minimum reward in USD (LOWERED to 10 to catch more markets)
  max_competition_bars: 3  # Maximum competition level (0-5) - INCREASED to allow more markets
  min_shares: 100  # Maximum minimum shares requirement

  # API Settings
  use_gamma_api: true  # Use Gamma API (faster, more reliable)
  api_fallback: true  # Fallback to Playwright if API fails

  # Categories to focus on
  target_categories: #[]  # Empty = all categories
- politics
- crypto
- science

  # Illiquid market threshold
  illiquid_threshold: 5000  # Markets with liquidity < $10k

# Market Selection AI
market_selection:
  # Scoring weights
  reward_weight: 0.3
  competition_weight: 0.5
  volume_weight: 0.05
  liquidity_weight: 0.05
  
  # Volume spike detection
  volume_spike_multiplier: 1.5
  volume_lookback_hours: 24
  
  # Maximum markets to trade simultaneously
  max_concurrent_markets: 5

# Order Management
order_management:
  # Dynamic spread range (in decimal, e.g., 0.008 = 0.8 cents)
  # WIDER SPREAD to avoid fills (liquidity farming strategy)
  spread_min: 0.03   # 3 cents (was 0.5 cents - too tight!)
  spread_max: 0.10   # 8 cents (was 1.5 cents - too tight!)

  # Position size range (number of shares)
  size_min: 20   # Giảm từ 200 xuống 50
  size_max: 100  # Giảm từ 500 xuống 100

  # Order type
  order_type: limit
  time_in_force: GTC  # Good Till Cancelled
  
  # Order update frequency
  update_interval: 30  # seconds
  
  # Price improvement attempts
  price_improvement_enabled: true
  price_improvement_tick: 0.001  # 0.1 cent

# Position Monitoring
monitoring:
  # WebSocket monitoring interval
  websocket_interval: 10  # seconds

  # Auto-cancel conditions (LIQUIDITY FARMING STRATEGY)
  partial_fill_threshold: 0.005  # Cancel if >5% filled (was 10% - too risky!)
  volume_spike_multiplier: 1.5  # Cancel if volume spikes >2x
  price_move_threshold: 0.005  # Cancel if price moves >2 cents

  # Position timeout (AUTO-CANCEL to avoid fills)
  # UPDATED: Increased to 45 minutes for position #3 strategy (less risk of fill)
  max_position_age: 2700  # 45 minutes (was 30 minutes)

  # Monitoring alerts
  alert_on_fill: true
  alert_on_cancel: false

# Profit Taking (AUTO-CLOSE PROFITABLE POSITIONS)
profit_taking:
  enabled: true  # Enable automatic profit taking
  check_interval: 300  # Check positions every 5 minutes

  # Profit thresholds
  min_profit_percentage: 2 # Start considering closing at 50% profit
  target_profit_percentage: 2 # Target profit to close position
  max_profit_percentage: 150  # Close immediately if profit >= 150%

  # Safety settings
  never_close_losing_positions: true  # NEVER auto-close losing positions
  min_hold_time: 300  # Hold position for at least 5 minutes before closing

  # Alerts
  alert_on_profit_close: true  # Send Telegram alert when closing profitable position

# Risk Management
risk_management:
  # Capital allocation
  max_capital_per_market: 0.5  # 5% of total capital
  max_total_exposure: 1 # 80% of total capital
  
  # Hedging
  enable_hedging: false
  hedge_threshold: 0.5  # Hedge if imbalance >60%
  partial_hedge_ratio: 0.5  # Hedge 50% of imbalance
  
  # Correlation limits
  max_markets_per_category: 3
  
  # Stop loss
  enable_stop_loss: true
  stop_loss_percentage: 0.15  # 15% loss per market
  
  # Value at Risk
  var_confidence: 0.95  # 95% confidence level
  max_var_percentage: 0.1  # 10% of capital

# Wallet Management
wallet_management:
  # Number of wallets to rotate
  num_wallets: 1
  
  # Human-like behavior
  jitter_percentage: 0.2  # ±20% variation
  min_wallet_cooldown: 60  # seconds between uses
  
  # Wallet switching
  random_switch_probability: 0.2  # 20% chance of random wallet
  time_based_switch: true
  switch_interval_min: 180  # 3 minutes
  switch_interval_max: 300  # 5 minutes
  
  # Human behavior simulation
  enable_breaks: true
  break_probability: 0.05  # 5% chance
  break_duration_min: 30  # seconds
  break_duration_max: 180  # seconds
  
  # Typing/action delays
  micro_delay_min: 0.05  # seconds
  micro_delay_max: 0.15  # seconds
  action_delay_min: 0.5  # seconds
  action_delay_max: 2.0  # seconds

# ML Prediction
ml_prediction:
  # Fill risk threshold
  fill_risk_threshold: 0.8  # Alert if >80% fill probability
  
  # Model training
  model_update_interval: 3600  # 1 hour in seconds
  min_training_samples: 100
  max_training_samples: 10000
  
  # Model parameters
  learning_rate: 0.001
  epochs: 50
  batch_size: 32
  
  # Feature engineering
  enable_feature_scaling: true
  feature_selection: auto
  
  # Model persistence
  model_path: models/fill_predictor.pt
  save_training_data: true
  training_data_path: data/training_data.pkl

# Daily Optimization
daily_optimization:
  # Optimization schedule (UTC)
  optimization_hour: 0  # Midnight UTC
  optimization_minute: 0
  
  # Performance analysis
  lookback_days: 7
  min_trades_for_analysis: 20
  
  # Strategy adjustment
  enable_auto_adjustment: true
  adjustment_sensitivity: 0.1  # 10% adjustment max
  
  # Payout calculation
  include_unrealized_pnl: false
  
  # Redeployment
  redeploy_underperforming: true
  performance_threshold: -0.05  # -5% return

# Reward Management (Automated Reward Checking & Withdrawal)
reward_management:
  # Enable automated reward checking and withdrawal
  # ⚠️ DISABLED FOR NOW - Bot is confusing trading capital with rewards!
  # Only enable this after you understand how Polymarket rewards work
  enabled: false

  # Check interval (in seconds)
  # 3600 = 1 hour, 7200 = 2 hours, 14400 = 4 hours, 86400 = 24 hours
  check_interval: 86400  # Check every 24 hours (not every hour!)

  # Minimum reward threshold before triggering withdrawal (in USDC)
  min_withdrawal_threshold: 10000.0  # Withdraw when rewards >= $50 (increased for safety)

  # Withdrawal wallet address (set in .env for security)
  # This is where rewards will be sent
  withdrawal_wallet: ""  # Set REWARD_WITHDRAWAL_WALLET in .env

  # Maximum gas price for withdrawal transactions (in Gwei)
  max_gas_price: 500  # Don't withdraw if gas > 500 Gwei

  # Retry settings for failed withdrawals
  max_retry_attempts: 3
  retry_delay: 300  # 5 minutes between retries

  # Alert settings
  alert_on_withdrawal: true  # Send alert when withdrawal occurs
  alert_on_withdrawal_failure: true  # Send alert on withdrawal failure
  alert_on_threshold_reached: true  # Send alert when threshold is reached

  # Safety settings
  require_confirmation: true  # REQUIRE manual confirmation before withdrawal!
  max_withdrawal_per_day: 1000.0  # Maximum USDC to withdraw per day (safety limit)

# Alerts and Notifications
alerts:
  # Telegram
  telegram_enabled: true
  telegram_bot_token: ""  # Set in .env
  telegram_chat_id: ""  # Set in .env

  # Discord/Slack Webhook
  webhook_enabled: false
  webhook_url: ""  # Set in .env

  # Alert levels
  alert_on_startup: true
  alert_on_shutdown: true
  alert_on_error: true
  alert_on_high_risk: true
  alert_on_daily_report: true

  # Performance alerts
  alert_on_profit_threshold: 100  # USD
  alert_on_loss_threshold: -50  # USD

  # Detailed Notifications (NEW!)
  # Bật/tắt từng loại thông báo chi tiết
  notifications:
    # Order notifications
    order_placed: true          # Thông báo khi đặt lệnh mới
    order_cancelled: false      # Thông báo khi hủy lệnh (có thể spam)
    order_filled: true          # Thông báo khi lệnh bị fill (QUAN TRỌNG!)

    # Market scanning notifications
    market_found: true          # Thông báo khi tìm thấy markets mới
    market_removed: false       # Thông báo khi markets bị loại bỏ (có thể spam)

    # Error & Alert notifications
    error: true                 # Thông báo khi có lỗi
    circuit_breaker: true       # Thông báo khi circuit breaker kích hoạt
    risk_alert: true            # Thông báo về rủi ro cao

    # Report notifications
    hourly_report: true         # Báo cáo hàng giờ
    daily_report: true          # Báo cáo hàng ngày

# Polymarket CLOB Settings
clob:
  host: "https://clob.polymarket.com"
  chain_id: 137  # Polygon mainnet
  
  # API endpoints
  api_base: "https://polymarket.com/api"
  rewards_endpoint: "/rewards"
  markets_endpoint: "/markets"
  
  # Rate limiting
  max_requests_per_second: 10
  request_timeout: 30  # seconds
  
  # WebSocket
  websocket_url: "wss://ws-subscriptions-clob.polymarket.com/ws"
  websocket_reconnect_delay: 5  # seconds
  websocket_ping_interval: 30  # seconds

# OrderBook WebSocket Settings (Real-time orderbook updates)
orderbook_websocket:
  # WebSocket URL for orderbook updates
  url: "wss://ws-subscriptions-clob.polymarket.com/ws/market"

  # Connection settings
  reconnect_delay: 5  # seconds
  ping_interval: 20  # seconds
  ping_timeout: 10  # seconds

  # Data freshness
  max_age: 5  # Consider data stale if older than 5 seconds

# Order Repositioning Settings (Maintain position 2-3 in orderbook)
order_repositioning:
  # Enable automatic order repositioning
  enabled: true

  # Check interval (how often to check if orders need repositioning)
  check_interval: 15  # seconds (check every 15 seconds)

  # Repositioning thresholds
  min_reposition_gap: 0.002  # $0.002 = 0.2 cents (reposition if price gap > this)

  # Rate limiting (prevent too many repositions)
  max_repositions_per_hour: 10  # Maximum 10 repositions per hour per market
  reposition_cooldown: 60  # Wait at least 60 seconds between repositions

  # Target position (maintain position 2 or 3, never position 1)
  target_position_min: 2  # Position #2 (0-indexed: 1)
  target_position_max: 3  # Position #3 (0-indexed: 2)

# Blockchain Settings
blockchain:
  # Polygon RPC
  rpc_url: "https://polygon-rpc.com"
  backup_rpc_urls:
    - "https://rpc-mainnet.matic.network"
    - "https://polygon-mainnet.infura.io/v3/YOUR_INFURA_KEY"
  
  # Gas settings
  max_gas_price: 500  # Gwei
  gas_price_multiplier: 1.1  # 10% above suggested
  
  # Transaction settings
  max_retries: 3
  retry_delay: 5  # seconds
  confirmation_blocks: 2

# Logging
logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  
  # File logging
  log_to_file: true
  log_file: logs/polymarket_bot.log
  log_rotation: daily
  log_retention_days: 30
  
  # Console logging
  log_to_console: true
  colored_logs: true
  
  # Performance logging
  log_performance_metrics: true
  metrics_interval: 300  # 5 minutes

# Database (Optional)
database:
  enabled: false
  type: sqlite  # sqlite, postgresql, mongodb
  
  # SQLite
  sqlite_path: data/bot_data.db
  
  # PostgreSQL
  postgres_host: localhost
  postgres_port: 5432
  postgres_database: polymarket_bot
  postgres_user: ""  # Set in .env
  postgres_password: ""  # Set in .env
  
  # MongoDB
  mongodb_uri: ""  # Set in .env
  mongodb_database: polymarket_bot

# Performance Tuning
performance:
  # Async settings
  max_concurrent_tasks: 50
  task_timeout: 60  # seconds
  
  # Caching
  enable_caching: true
  cache_ttl: 300  # 5 minutes
  
  # Connection pooling
  connection_pool_size: 10
  
  # Memory management
  max_memory_mb: 1024  # 1GB
  gc_interval: 600  # 10 minutes

# Development/Testing
development:
  # Test mode (no real orders) - SET TO FALSE FOR LIVE TRADING
  test_mode: false

  # Paper trading - SET TO FALSE FOR LIVE TRADING
  paper_trading: false
  paper_trading_capital: 10000

  # Simulation
  simulate_fills: false
  fill_simulation_probability: 0.3

  # Debug features
  verbose_logging: false
  save_debug_data: false
  debug_data_path: data/debug/

